remake_pop_mark_base = {
    set_variable = { ind_upd = max_manpower_k }
    divide_variable = {
        var = ind_upd
        value = num_of_factories
    }
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 3000 }
                check_variable = { num_of_factories < 1 }
            }
        }
        set_variable = { pop_base = 20 }
    }
    else = {
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 2000 }
                check_variable = { num_of_factories < 5 }
            }
        }
        set_variable = { pop_base = 40 }
    }
    else = {
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 1000 }
                check_variable = { num_of_factories < 15 }
            }
        }
        set_variable = { pop_base = 60 }
    }
    else = {
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 500 }
                check_variable = { num_of_factories < 25 }
            }
        }
        set_variable = { pop_base = 80 }
    }
    else = {
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 300 }
                check_variable = { num_of_factories < 35 }
            }
        }
        set_variable = { pop_base = 100 }
    }
    else = {
    if = {
        limit = {
            OR = {
                check_variable = { ind_upd > 150 }
                check_variable = { num_of_factories < 35 }
            }
        }
        set_variable = { pop_base = 200 }
    }
    else = {
        set_variable = { pop_base = 240 }
    }
    }}}}}
}
remake_national_factory_tot_cost = {
    set_variable = { national_factory_tot_cost = 0 }
    set_variable = { mil_cost = global.mil_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { mil_cost = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { mil_cost = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { mil_cost = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { mil_cost = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { mil_cost = global.high_wages }
    }
    add_to_variable = { mil_cost = global.mil_fac_raw_cost }
    divide_variable = { mil_cost = global.one_bil }
    multiply_variable = { mil_cost = mil_num }
    add_to_variable = {
        national_factory_tot_cost = mil_cost
    }

    set_variable = { ind_cost = global.ind_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { ind_cost = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { ind_cost = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { ind_cost = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { ind_cost = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { ind_cost = global.high_wages }
    }
    add_to_variable = { ind_cost = global.ind_fac_raw_cost }
    divide_variable = { ind_cost = global.one_bil }
    multiply_variable = { ind_cost = ind_num }
    add_to_variable = {
        national_factory_tot_cost = ind_cost
    }
    
    set_variable = { docker_cost = global.docker_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { docker_cost = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { docker_cost = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { docker_cost = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { docker_cost = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { docker_cost = global.high_wages }
    }
    add_to_variable = { docker_cost = global.docker_fac_raw_cost }
    divide_variable = { docker_cost = global.one_bil }
    multiply_variable = { docker_cost = docker_num }
    add_to_variable = {
        national_factory_tot_cost = docker_cost
    }
}
remake_private_factory_tot_cost = {
    set_variable = { private_cost = global.ind_fac_worker }
    if = {
        limit = {
            check_variable = { private_worker_wage = 1 }
        }
        multiply_variable = { private_cost = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 2 }
        }
        multiply_variable = { private_cost = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 3 }
        }
        multiply_variable = { private_cost = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 4 }
        }
        multiply_variable = { private_cost = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 5 }
        }
        multiply_variable = { private_cost = global.high_wages }
    }
    add_to_variable = { private_cost = global.ind_fac_raw_cost }
    divide_variable = { private_cost = global.one_bil }
    set_variable = { an_private_cost = private_cost }
    multiply_variable = { private_cost = private_goods_factory }
}
remake_this_month_goods = {
    set_variable = {
        this_month_goods = global.an_ind_goods
    }
    divide_variable = {
        this_month_goods = global.one_bil
    }
    multiply_variable = {
        this_month_goods = now_use_national_goods_factory
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = {
            this_month_goods = global.low_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = {
            this_month_goods = global.low_mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = {
            this_month_goods = global.mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = {
            this_month_goods = global.high_mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = {
            this_month_goods = global.high_wages_factor
        }
    }
    set_variable = {
        mid_w = global.an_ind_goods
    }
    divide_variable = {
        mid_w = global.one_bil
    }
    multiply_variable = {
        mid_w = private_goods_factory
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 1 }
        }
        multiply_variable = {
            mid_w = global.low_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 2 }
        }
        multiply_variable = {
            mid_w = global.low_mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 3 }
        }
        multiply_variable = {
            mid_w = global.mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 4 }
        }
        multiply_variable = {
            mid_w = global.high_mid_wages_factor
        }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 5 }
        }
        multiply_variable = {
            mid_w = global.high_wages_factor
        }
    }
    add_to_variable = {
        this_month_goods = mid_w
    }
    set_variable = {
        private_goods_qwq = mid_w
    }
}
remake_fac_nums = {
    set_variable = { ind_num = num_of_civilian_factories }
    set_variable = { mil_num = num_of_military_factories }
    set_variable = { docker_num = num_of_naval_factories }
}
remake_market_from_worker = {
    set_variable = { mid_w = global.ind_fac_worker }
    if = {
        limit = {
            check_variable = { private_worker_wage = 1 }
        }
        multiply_variable = { mid_w = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 2 }
        }
        multiply_variable = { mid_w = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 3 }
        }
        multiply_variable = { mid_w = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 4 }
        }
        multiply_variable = { mid_w = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { private_worker_wage = 5 }
        }
        multiply_variable = { mid_w = global.high_wages }
    }
    divide_variable = { mid_w = global.one_bil }
    multiply_variable = { mid_w = private_goods_factory }
    set_variable = { market_from_pri_fac = mid_w }

    set_variable = { mid_w = global.ind_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { mid_w = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { mid_w = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { mid_w = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { mid_w = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { mid_w = global.high_wages }
    }
    divide_variable = { mid_w = global.one_bil }
    multiply_variable = { mid_w = ind_num }
    set_variable = {  market_from_ind_fac = mid_w }

    set_variable = { mid_w = global.mil_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { mid_w = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { mid_w = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { mid_w = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { mid_w = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { mid_w = global.high_wages }
    }
    divide_variable = { mid_w = global.one_bil }
    set_variable = { tot_goods_fac = 0 }
    multiply_variable = { mid_w = mil_num }
    set_variable = { market_from_mil_fac = mid_w }
    set_variable = { mid_w = global.docker_fac_worker }
    if = {
        limit = {
            check_variable = { national_worker_wage = 1 }
        }
        multiply_variable = { mid_w = global.low_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 2 }
        }
        multiply_variable = { mid_w = global.low_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 3 }
        }
        multiply_variable = { mid_w = global.mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 4 }
        }
        multiply_variable = { mid_w = global.high_mid_wages }
    }
    if = {
        limit = {
            check_variable = { national_worker_wage = 5 }
        }
        multiply_variable = { mid_w = global.high_wages }
    }
    divide_variable = { mid_w = global.one_bil }
    set_variable = { tot_goods_fac = 0 }
    multiply_variable = { mid_w = docker_num }
    set_variable = { market_from_doc_fac = mid_w }
}
remake_people_market = {
    set_variable = { num_of_people = 0 }
    every_controlled_state = {
        add_to_variable = { PREV.num_of_people = state_population_k }
    }
    set_variable = {
        people_mark_tot = num_of_people
    }
    divide_variable = {
        people_mark_tot = global.one_bil
    }
    multiply_variable = { people_mark_tot = pop_base }
}
remake_market = {
    set_variable = { large_of_market = 0 }
    remake_market_from_worker = yes 
    remake_people_market = yes
    add_to_variable = { large_of_market = market_from_pri_fac }
    add_to_variable = { large_of_market = market_from_ind_fac }
    add_to_variable = { large_of_market = market_from_mil_fac }
    add_to_variable = { large_of_market = market_from_doc_fac }
    add_to_variable = { large_of_market = people_mark_tot }
    set_variable = { tot_large_of_market = large_of_market }
    if = {
        limit = {
            check_variable = { people_tax < 0.45 }
        }
        set_variable = { capital_upd_qwq = 0.05 }
    }
    else = {
        set_variable = { capital_upd_qwq = 0.5 }
        subtract_from_variable = { capital_upd_qwq = people_tax }
    }
    set_variable = { capital_upd = tot_large_of_market }
    multiply_variable = { capital_upd = capital_upd_qwq }
    subtract_from_variable = { large_of_market = capital_upd }
    if = {
        limit = {
            check_variable = { people_tax > 0.5 }
        }
        set_variable = { pay_for_food = 1 }
        subtract_from_variable = { pay_for_food = people_tax }
    }
    else = { set_variable = { pay_for_food = 0.5 } }
    set_variable = { pop_foods_cost = tot_large_of_market }
    multiply_variable = { pop_foods_cost = pay_for_food }
    subtract_from_variable = { large_of_market = pop_foods_cost }

    set_variable = { our_tax_from_people = tot_large_of_market }
    multiply_variable = { our_tax_from_people = people_tax }
    subtract_from_variable = { large_of_market = our_tax_from_people }

    set_variable = { before_large_of_market = large_of_market }
}
clamp_new_economy_goods_factory = {
    remake_fac_nums = yes
    clamp_variable = {
        var = national_goods_factory
        max = ind_num
    }
    clamp_variable = {
        var = national_goods_factory
        min = 0
    }
}
clamp_worker_wage = {
    clamp_variable = {
        var = private_worker_wage
        max = 5
    }
    clamp_variable = {
        var = private_worker_wage
        min = 1
    }
    clamp_variable = {
        var = national_worker_wage
        max = 5
    }
    clamp_variable = {
        var = national_worker_wage
        min = 1
    }
    remake_fac_nums = yes
    remake_national_factory_tot_cost = yes
    remake_this_month_goods = yes
}
monthly_build_new_economy = {
    set_variable = { new_nat_tre_det = 0 }
    remake_private_factory_tot_cost = yes
    while_loop_effect = {
        break = temp_break
        limit = {
            check_variable = { private_cost < private_capital }
            check_variable = { private_worker_wage < 5 }
        }
        add_to_variable = { private_worker_wage = 1 }
        remake_private_factory_tot_cost = yes
    }
    while_loop_effect = {
        break = temp_break
        limit = {
            check_variable = { private_cost > private_capital }
            check_variable = { private_worker_wage > 1 }
        }
        add_to_variable = { private_worker_wage = -1 }
        remake_private_factory_tot_cost = yes
    }
    ai_worker_wage_work = yes
    clamp_worker_wage = yes
    clamp_new_economy_goods_factory = yes
    set_variable = {
        this_month_goods = 0
    }
    remake_fac_nums = yes
    force_update_dynamic_modifier = yes
    remake_national_factory_tot_cost = yes
    remake_this_month_goods = yes
    set_variable = {
        surplus_month_goods = this_month_goods
    }
    remake_market = yes
}
sell_goods = {
    # our_nation_not_sphere
    every_country = {
        limit = {
            check_variable = { surplus_month_goods > 0 }
            OR = {
                check_variable = { in_a_sphere = 0 }
                is_subject = yes
            }
        }
        set_variable = { wanana_sell_goods = surplus_month_goods }
        clamp_variable = {
            var = wanana_sell_goods 
            max = large_of_market
        }
        subtract_from_variable = { large_of_market = wanana_sell_goods }
        subtract_from_variable = { surplus_month_goods = wanana_sell_goods }
    }
    # spheres
    every_country = {
        limit = {
            check_variable = { surplus_month_goods > 0 }
            check_variable = { is_a_gerat_power = 1 }
        }
        every_country = {
            limit = {
                check_variable = { in_a_sphere = 1 }
                check_variable = { sphere_country = PREV }
                check_variable = { large_of_market > 0 }
            }
            set_variable = { PREV.wanana_sell_goods = PREV.surplus_month_goods }
            clamp_variable = {
                var = PREV.wanana_sell_goods 
                max = large_of_market
            }
            subtract_from_variable = { large_of_market = PREV.wanana_sell_goods }
            subtract_from_variable = { PREV.surplus_month_goods = PREV.wanana_sell_goods }
        }
    }
    every_country = {
        limit = {
            check_variable = { surplus_month_goods > 0 }
        }
        every_subject_country = {
            limit = {
                check_variable = { large_of_market > 0 }
            }
            set_variable = { PREV.wanana_sell_goods = PREV.surplus_month_goods }
            clamp_variable = {
                var = PREV.wanana_sell_goods 
                max = large_of_market
            }
            subtract_from_variable = { large_of_market = PREV.wanana_sell_goods }
            subtract_from_variable = { PREV.surplus_month_goods = PREV.wanana_sell_goods }
        }
    }
    # our_nation
    every_country = {
        limit = {
            check_variable = { surplus_month_goods > 0 }
        }
        set_variable = { wanana_sell_goods = surplus_month_goods }
        clamp_variable = {
            var = wanana_sell_goods 
            max = large_of_market
        }
        subtract_from_variable = { large_of_market = wanana_sell_goods }
        subtract_from_variable = { surplus_month_goods = wanana_sell_goods }
    }
    # other_nation
    # every_country = {
    #    limit = {
    #        check_variable = { surplus_month_goods > 0 }
    #    }
    #    every_country = {
    #        limit = {
    #            check_variable = { large_of_market > 0 }
    #        }
    #        set_variable = { PREV.wanana_sell_goods = PREV.surplus_month_goods }
    #        clamp_variable = {
    #            var = PREV.wanana_sell_goods 
    #            max = large_of_market
    #        }
    #        subtract_from_variable = { large_of_market = PREV.wanana_sell_goods }
    #        subtract_from_variable = { PREV.surplus_month_goods = PREV.wanana_sell_goods }
    #    }
    # }
}
distribute_profits = {
    set_variable = {
        an_factory_profits = this_month_goods
    }
    subtract_from_variable = {
        an_factory_profits = surplus_month_goods
    }
    set_variable = { mid_w = private_goods_factory }
    add_to_variable = { mid_w = now_use_national_goods_factory }
    divide_variable = {
        an_factory_profits = mid_w
    }
    set_variable = {
        national_factory_tot_profits = an_factory_profits
    }
    multiply_variable = {
        national_factory_tot_profits = now_use_national_goods_factory
    }
    # add_to_variable = { new_nat_tre_det = national_factory_tot_profits }
    set_variable = {
        private_goods_cnts = an_factory_profits
    }
    multiply_variable = {
        private_goods_cnts = private_goods_factory
    }
    add_to_variable = {
        private_capital = private_goods_cnts
    }
    set_variable = {
        our_tax_from_factory = private_goods_cnts
    }
    multiply_variable = {
        our_tax_from_factory = tax_qwq
    }
    subtract_from_variable = {
        private_capital = our_tax_from_factory
    }
    # add_to_variable = { new_nat_tre_det = our_tax_from_factory }
}
remake_nat_tre_add = {
    set_variable = { new_nat_tre_add = 0 }
    add_to_variable = { new_nat_tre_add = our_tax_from_factory }
    add_to_variable = { new_nat_tre_add = national_factory_tot_profits }
    add_to_variable = { new_nat_tre_add = our_tax_from_people }
}
remake_mil_spend = {
	set_variable = { military_spend = num_battalions}
	multiply_variable = {var = military_spend value = 0.005}
}
remake_pop_cost = {
    set_variable = { num_of_people = 0 }
    every_controlled_state = {
        add_to_variable = { PREV.num_of_people = state_population_k }
    }
    set_variable = { people_cost = num_of_people }
    divide_variable = { var = people_cost value = 10000 }
}
remake_nat_tre_del = {
    set_variable = { new_nat_tre_del = 0 }
    add_to_variable = { new_nat_tre_del = national_factory_tot_cost }
    set_variable = { before_national_factory_tot_cost = national_factory_tot_cost }
    add_to_variable = { new_nat_tre_del = military_spend }
    add_to_variable = { new_nat_tre_del = people_cost }
}
payroll_qwq = {
    remake_national_factory_tot_cost = yes
    remake_private_factory_tot_cost = yes
    remake_mil_spend = yes
    remake_pop_cost = yes
    remake_nat_tre_add = yes
    remake_nat_tre_del = yes
    set_variable = { new_nat_tre_det = new_nat_tre_add }
    subtract_from_variable = { new_nat_tre_det = new_nat_tre_del }
    set_variable = { new_nat_tre_profits_to_factory = new_nat_tre_det }
    
    add_to_variable = { new_nat_tre_profits_to_factory = national_factory_tot_cost }

    add_to_variable = { private_capital = capital_upd }
    subtract_from_variable = { private_capital = private_cost }
}
industrial_expansion = {
    set_variable = {
        now_a_new_ind_cost = an_private_cost
    }
    add_to_variable = {
        now_a_new_ind_cost = global.a_new_ind_cost
    }
    set_variable = {
        mid_w = 0
    }
    while_loop_effect = {
        break = temp_break
        limit = {
            check_variable = { private_capital > now_a_new_ind_cost }
        }
        add_to_variable = { private_goods_factory = 1 }
        subtract_from_variable = { private_capital = now_a_new_ind_cost }
        add_to_variable = { mid_w = an_private_cost }
    }
    add_to_variable = {
        private_capital = mid_w
    }
    #sell factory
    while_loop_effect = {
        break = temp_break
        limit = {
            check_variable = { private_capital < 0 }
            check_variable = { private_goods_factory > 0 }
        }
        add_to_variable = { private_goods_factory = -1 }
        add_to_variable = { private_capital = global.sell_a_ind }
    }
    while_loop_effect = {
        break = temp_break
        limit = {
            check_variable = { private_worker_wage < 2 }
        }
        add_to_variable = { private_worker_wage = 1 }
        remake_private_factory_tot_cost = yes
        while_loop_effect = {
            break = temp_break_1
            limit = {
                check_variable = { private_cost > private_capital }
                check_variable = { private_goods_factory > 0 }
            }
            add_to_variable = { private_goods_factory = -1 }
            add_to_variable = { private_capital = global.a_new_ind_cost }
            remake_private_factory_tot_cost = yes
        }
    }
    #bankruptcy!
    if = {
        limit = {
            check_variable = { private_capital < 0 }
            check_variable = { private_goods_factory = 0 }
        }
        set_variable = {
            private_capital = 0
        }
    }
}
ai_worker_wage_work = {
    if = {
        limit = {
            OR = {
                is_ai = yes
                check_variable = { global.autowork = 1 }
            }
        }
        remake_national_factory_tot_cost = yes
        while_loop_effect = {
            break = temp_break
            limit = {
                check_variable = { national_factory_tot_cost < new_nat_tre_profits_to_factory }
                check_variable = { national_worker_wage < 5 }
            }
            add_to_variable = { national_worker_wage = 1 }
            remake_national_factory_tot_cost = yes
        }
        while_loop_effect = {
            break = temp_break
            limit = {
                check_variable = { national_factory_tot_cost > new_nat_tre_profits_to_factory }
                check_variable = { national_worker_wage > 1 }
            }
            add_to_variable = { national_worker_wage = -1 }
            remake_national_factory_tot_cost = yes
        }
    }
}
ai_goods_factory_work = {
    if = {
        limit = {
            OR = {
                is_ai = yes
                check_variable = { global.autowork = 1 }
            }
        }
        set_variable = { ind_goods_qwq = global.an_ind_goods }
        divide_variable = { ind_goods_qwq = global.one_bil }
        set_variable = { mid_w = 0 }
        while_loop_effect = {
            break = temp_break
            limit = {
                check_variable = { national_goods_factory > 0 }
                check_variable = { surplus_month_goods > mid_w }
            }
            add_to_variable = { national_goods_factory = -1 }
            add_to_variable = { mid_w = ind_goods_qwq }
        }
        set_variable = { mid_w = 0 }
        while_loop_effect = {
            break = temp_break
            limit = {
                check_variable = { national_goods_factory < ind_num }
                check_variable = { new_nat_tre_det < mid_w }
            }
            add_to_variable = { national_goods_factory = 1 }
            subtract_from_variable = { mid_w = ind_goods_qwq }
        }
        clamp_new_economy_goods_factory = yes
    }
}
ai_tax_work = {
    if = {
        limit = {
            OR = {
                is_ai = yes
                check_variable = { global.autowork = 1 }
            }
        }
        remake_market = yes
        remake_national_factory_tot_cost = yes
        remake_private_factory_tot_cost = yes
        remake_mil_spend = yes
        remake_pop_cost = yes
        remake_nat_tre_add = yes
        remake_nat_tre_del = yes
        while_loop_effect = {
            break = temp_break
            limit = {
                check_variable = { people_tax < 1 }
                check_variable = { new_nat_tre_add < new_nat_tre_del }
            }
            add_to_variable = { people_tax = 0.05 }
            add_to_variable = { people_tax_qaq = 5 }
            remake_market = yes
            remake_national_factory_tot_cost = yes
            remake_private_factory_tot_cost = yes
            remake_mil_spend = yes
            remake_pop_cost = yes
            remake_nat_tre_add = yes
            remake_nat_tre_del = yes
        }
    }
}
monthly_we_do = {
    every_country = {
        monthly_build_new_economy = yes
    }
    every_country = {
        set_variable = {
            shpere_market = 0
        }
    }
    every_country = {
        if = {
            limit = {
                check_variable = { in_a_sphere = 1 }
            }
            var:sphere_country = {
                add_to_variable = { shpere_market = PREV.before_large_of_market }
            }
        }
    }
    sell_goods = yes
    every_country = {
        distribute_profits = yes
        payroll_qwq = yes
        add_to_variable = { new_nat_tre = new_nat_tre_det }
        ai_tax_work = yes

        industrial_expansion = yes
        ai_goods_factory_work = yes
        
        set_variable = { now_use_national_goods_factory = national_goods_factory }
        remake_this_month_goods = yes
    }
}